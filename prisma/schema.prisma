// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  name      String?
  email     String   @unique
  password  String   
  role      String   @default("USER")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  logs      Log[]
}

model Log {
  id        String   @id @default(cuid())
  action    String   
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  timestamp DateTime @default(now())
}

model Goal {
  id           String   @id @default(uuid())
  category     String   
  metric       String   
  label        String   
  value        Float    
  month        String   
  filter_group String?  
  updatedAt    DateTime @updatedAt
  @@unique([metric, month])
}

// TABELA FINANCEIRA (Origem: Scraper - worker_faturamento_scraping.py)
// Contém apenas o que foi faturado/pago.
model FaturamentoAnalitico {
  hash_id        String   @id
  unidade        String
  grupo          String?  
  procedimento   String?
  total_pago     Float?   @map("total_pago")
  data_pagamento String?  @map("data_do_pagamento") // DD/MM/YYYY
  data_ref       String?  @map("data_de_referência")
  paciente       String?
  updated_at     String
  
  @@map("faturamento_analitico")
}

// TABELA DE AGENDAMENTOS (Origem: API - worker_feegow.py)
// Contém status futuros e não faturados.
model FeegowAppointment {
  appointment_id    Int      @id
  date              String   // YYYY-MM-DD
  status_id         Int
  value             Float
  specialty         String?
  professional_name String?
  procedure_group   String?
  updated_at        DateTime @default(now())

  @@map("feegow_appointments")
}